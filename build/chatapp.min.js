var app=angular.module("ChatApp",["ngRoute"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"templates/home.html",controller:"LoginController"}).when("/room/:roomName",{templateUrl:"templates/room.html",controller:"RoomController"}).otherwise({redirectTo:"/"})}]),app.controller("LoginController",["$scope","$location","SocketService",function(a,b,c){a.username="",a.message="";var d=io.connect("http://localhost:8080");a.connect=function(){if(d){if(""===a.username)return $(".error-msg").fadeIn(),a.message="Name can't empty",void setTimeout(function(){$(".error-msg").fadeOut()},5500);d.emit("adduser",a.username,function(e){e?(c.setConnected(d),c.setUsername(a.username),b.path("/room/lobby"),setTimeout(function(){$("#create-room").fadeIn()},500)):($(".error-msg").fadeIn(),a.message="Your name is taken, please choose another",setTimeout(function(){$(".error-msg").fadeOut()},5500)),a.$apply()})}}}]),app.controller("RoomController",["$scope","$routeParams","$location","SocketService",function(a,b,c,d){a.roomName=b.roomName,a.currentMessage="";var e=d.getSocket();e&&(e.emit("joinroom",{room:a.roomName,pass:""},function(){}),e.on("updatechat",function(b,c){a.messages=c,a.$apply();var d=$(".chat-window")[0].scrollHeight;$(".chat-window").scrollTop(d)}),e.on("updateusers",function(b,c){b===a.roomName&&(a.users=c)}),e.emit("rooms"),e.on("roomlist",function(b){console.log(b),a.rooms=b,a.$apply()})),a.send=function(){e&&(console.log("I sent a message to "+a.roomName+": "+a.currentMessage),e.emit("sendmsg",{roomName:a.roomName,msg:a.currentMessage}),a.currentMessage="")},a.keyPress=function(b){13===b.keyCode&&a.send()},a.createRoom=function(){console.log("NEW ROOM"),$("#blackout").fadeIn(),$("#create-room").fadeIn()},a.create=function(){var a=$("#room-name").val();$("#blackout").fadeOut(),$("#create-room").fadeOut(),c.path("/room/"+a)},a.menuClose=function(){console.log("close menu"),$("#create-room").fadeOut(),$("#blackout").fadeOut()}}]),app.factory("SocketService",["$http",function(){var a,b="";return{setConnected:function(b){a=b},setUsername:function(a){b=a},getUsername:function(){return b},getSocket:function(){return a}}}]);